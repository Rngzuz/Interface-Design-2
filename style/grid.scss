@import "variables";

//Enclose content in a media query if $containerWidth is greater than 0 and not null.
@mixin createColumnMediaQuery($containerWidth) {
    @if $containerWidth == 0 or $containerWidth == null {
        @content;
    } @else {
        @media (min-width: $containerWidth) {
            @content;
        }
    }
}

//Creates the grid container, row and columns based on the parameters.
@mixin createSections($containerName, $rowName, $columnName, $columnNumber, $columnGutter, $breakpoint, $lastColumnGutter, $hasFlex) {
    .col {
        flex-basis: 0;
        flex-grow: 1;
        max-width: 100%;
    }


    @include createColumnMediaQuery($breakpoint) {
        @if ($columnGutter and $columnGutter != $lastColumnGutter) {
            .#{$containerName} {
                width: $breakpoint;
                padding-right: $columnGutter;
                padding-left: $columnGutter;
                margin-right: auto;
                margin-left: auto;
            }

            .#{$rowName} {
                @if not $hasFlex {
                    display: flex;
                    flex-wrap: wrap;
                }
                margin-right: floor(-$columnGutter / 2);
                margin-left: floor(-$columnGutter / 2);
            }
        } @else {
            @if not $hasFlex {
                .#{$rowName} {
                    display: flex;
                    flex-wrap: wrap;
                }
            }

            .#{$containerName} {
                width: $breakpoint;
                padding-right: $columnGutter;
                padding-left: $columnGutter;
                margin-right: auto;
                margin-left: auto;
            }
        }

        [class*="col"] {
            padding-right: floor($columnGutter / 2);
            padding-left: floor($columnGutter / 2);
        }

        .space#{$columnName},
        .space {
            padding-bottom: $columnGutter;
        }

        .nospace#{$columnName},
        .nospace {
            padding-bottom: 0;
        }

        @for $columnIndex from 1 through $columnNumber {
            $width: 100%/$columnNumber*$columnIndex;

            .col#{$columnName}-#{$columnIndex} {
                flex: 0 0 $width;
                max-width: $width;
            }
        }
    }
}

//Uses createSections() multiple times based on the passed list arguments.
@mixin createGrid($list...) {
    $lastColumnGutter: null;
    $hasFlex: false;

    @each $containerName, $rowName, $columnName, $columnNumber, $columnGutter, $breakpoint in $list {
        @include createSections(
            $containerName,
            $rowName,
            $columnName,
            $columnNumber,
            $columnGutter,
            $breakpoint,
            $lastColumnGutter,
            $hasFlex
        );

        $lastColumnGutter: $columnGutter;
        $hasFlex: true;
    }
}

@include createGrid(
    ($containerName, $rowName, "-small", $columnCount, $defaultPadding, null),
    ($containerName, $rowName, "-medium", $columnCount, $defaultPadding, $columnMedium),
    ($containerName, $rowName, "-large", $columnCount, $defaultPadding, $columnLarge)
);